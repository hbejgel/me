---
import OdysseyLayout from '../layouts/OdysseyLayout.astro';
import Troy from '../components/encounters/Troy.astro';
import LotusEaters from '../components/encounters/LotusEaters.astro';
import Cyclops from '../components/encounters/Cyclops.astro';
import Aeolus from '../components/encounters/Aeolus.astro';
import Laestrygonians from '../components/encounters/Laestrygonians.astro';
import Circe from '../components/encounters/Circe.astro';
import Underworld from '../components/encounters/Underworld.astro';
import UnderworldOverlay from '../components/encounters/UnderworldOverlay.astro';
import Sirens from '../components/encounters/Sirens.astro';
import ScyllaCharybdis from '../components/encounters/ScyllaCharybdis.astro';
import CattleOfTheSun from '../components/encounters/CattleOfTheSun.astro';
import Calypso from '../components/encounters/Calypso.astro';
import Ithaca from '../components/encounters/Ithaca.astro';
---

<OdysseyLayout>
  <div class="odyssey-container">
    <!-- Underworld Overlay -->
    <UnderworldOverlay />
    
    <!-- Fixed Title -->
    <div class="page-title">
      <h1>The Odyssey</h1>
    </div>
    
    <div class="journey-track">
      <!-- Water/Wave Effects -->
      <div class="water-layer">
        <div class="wave"></div>
        <div class="wave"></div>
        <div class="wave"></div>
        <div class="foam"></div>
      </div>
      <!-- Odysseus Character -->
      <div class="odysseus-character">       
        <img src="/me/ship.png" alt="Odysseus Ship" width="64" height="64" class="main-ship" />
        <img src="/me/ship.png" alt="Fleet Ship 1" width="32" height="32" class="fleet-ship ship-1" />
        <img src="/me/ship.png" alt="Fleet Ship 2" width="32" height="32" class="fleet-ship ship-2" />
        <img src="/me/ship.png" alt="Fleet Ship 3" width="32" height="32" class="fleet-ship ship-3" />
        <img src="/me/ship.png" alt="Fleet Ship 4" width="32" height="32" class="fleet-ship ship-4" />
      </div>

      <!-- Troy - Starting Point -->
      <Troy />

      <!-- Lotus-Eaters -->
      <LotusEaters />

      <!-- Encounters -->
      <Cyclops />
      <Aeolus />
      <Laestrygonians />
      <Circe />
      <Underworld />
      <Sirens />
      <ScyllaCharybdis />
      <CattleOfTheSun />
      <Calypso />
      <Ithaca />
    </div>
  </div>
</OdysseyLayout>

<style>
  @import '../components/encounters/animations.css';
  @import '../components/encounters/encounter-styles.css';
  .odyssey-container {
    width: 100%;
    height: 100vh;
    height: 100dvh; /* Dynamic viewport height for mobile */
    overflow-x: auto;
    overflow-y: hidden;
    background: linear-gradient(90deg, #2C1810 0%, #8B4513 20%, #D2691E 50%, #8B4513 80%, #2C1810 100%);
    position: relative;
    /* Greek pattern overlay */
    background-image: 
      linear-gradient(90deg, #2C1810 0%, #8B4513 20%, #D2691E 50%, #8B4513 80%, #2C1810 100%),
      repeating-linear-gradient(
        45deg,
        transparent,
        transparent 10px,
        rgba(255, 255, 255, 0.03) 10px,
        rgba(255, 255, 255, 0.03) 20px
      );
    /* Ensure scrollbar is always visible */
    scrollbar-width: thin;
    scrollbar-color: #8B4513 #2C1810;
    /* Mobile touch scrolling improvements */
    -webkit-overflow-scrolling: touch;
    touch-action: pan-x pan-y;
  }

  /* Fixed Title */
  .page-title {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    z-index: 10;
    text-align: center;
    padding: 20px 0;
    background-color: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(5px);
  }

  .page-title h1 {
    color: #F5F5DC;
    font-family: 'Cinzel', 'Times New Roman', serif;
    font-size: 3rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin: 0;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
  }

  .water-layer {
    min-width: 8000px;
    width: 8000px;
  }

  /* Mobile responsive adjustments */
  @media (max-width: 480px) {
    .page-title h1 {
      font-size: 1.2rem;
    }
    
    .text-bubble {
      margin-top: 50px;
    }

    /* Additional mobile fixes */
    .odysseus-character {
      transform: scale(1.5) !important;
    }
  }
  
  @media (max-width: 768px) {
    .page-title {
      padding: 10px 0;
    }
    
    .page-title h1 {
      font-size: 1.5rem;
      letter-spacing: 0.05em;
    }
    
    .text-bubble {
      margin-top: 60px;
    }

    /* Prevent vertical scrolling on mobile */
    body, html {
      overflow-y: hidden;
      position: fixed;
      width: 100%;
      height: 100%;
    }
    
    /* Ensure smooth touch scrolling on mobile */
    .odyssey-container {
      touch-action: pan-x pan-y;
      -webkit-overflow-scrolling: touch;
    }
  }

  .journey-track {
    display: flex;
    align-items: center;
    width: 100%;
    height: 100%;
    padding: 0;
    position: relative;
    min-width: 8000px;
    /* Ensure content doesn't overflow vertically on mobile */
    max-height: 100vh;
    max-height: 100dvh;
    /* Ensure water layer spans full width */
    overflow: visible;
  }

  .odysseus-character {
    position: fixed;
    left: 20px;
    top: 65%;
    transform: translateY(-50%);
    z-index: 1000;
    transition: left 0.3s ease;
    transform: scale(2.0);
    transform-origin: top left;
  }

  /* Fleet ships positioning */
  .odysseus-character .main-ship {
    position: relative;
    z-index: 2;
  }

  .odysseus-character .fleet-ship {
    position: absolute;
    opacity: 1.0;
    transition: all 0.8s ease;
    animation: ship-bob 3s ease-in-out infinite;
  }

  .odysseus-character .main-ship {
    position: relative;
    z-index: 2;
    animation: ship-bob 3s ease-in-out infinite;
  }

  @keyframes ship-bob {
    0%, 100% {
      transform: translateY(0px);
    }
    50% {
      transform: translateY(-8px);
    }
  }

  .odysseus-character .ship-1 {
    top: -15px;
    left: -25px;
    animation-delay: 0s;
  }

  .odysseus-character .ship-2 {
    top: 40px;
    right: -30px;
    animation-delay: 0.5s;
  }

  .odysseus-character .ship-3 {
    bottom: -20px;
    left: -15px;
    animation-delay: 1s;
  }

  .odysseus-character .ship-4 {
    bottom: 50px;
    right: -15px;
    animation-delay: 1.5s;
  }

  /* Scrollbar styling */
  .odyssey-container::-webkit-scrollbar {
    height: 16px; /* Make scrollbar taller */
    z-index: 10005; /* Ensure it's above everything */
  }

  .odyssey-container::-webkit-scrollbar-track {
    background: #2C1810;
    z-index: 10005;
  }

  .odyssey-container::-webkit-scrollbar-thumb {
    background: linear-gradient(90deg, #8B4513, #D2691E);
    border-radius: 8px;
    z-index: 10005;
    /* Ensure scrollbar is always visible */
    opacity: 1 !important;
    visibility: visible !important;
  }

  .odyssey-container::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(90deg, #D2691E, #CD853F);
  }

  /* Firefox scrollbar styling */
  .odyssey-container {
    scrollbar-width: thin;
    scrollbar-color: #8B4513 #2C1810;
  }

  /* Enhanced scrollbar visibility during Underworld */
  .odyssey-container.underworld-active::-webkit-scrollbar-thumb {
    background: linear-gradient(90deg, #D2691E, #CD853F);
    /* Keep the same styling but ensure visibility */
  }
</style>

<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Crimson+Text:ital,wght@0,400;1,400&display=swap" rel="stylesheet" />
<script src="../components/encounters/odyssey.ts"></script> 